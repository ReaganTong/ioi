<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:mobile_app.ViewModels"
             x:Class="mobile_app.Views.ProfilePage"
             Title="My Profile"
             BackgroundColor="#F5F5F5">

    <ContentPage.Resources>
        <ResourceDictionary>
            <viewmodels:BoolToObjectConverter x:Key="BoolToObjectConverter" 
                                              TrueObject="Save Changes" 
                                              FalseObject="Edit Profile" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <ContentPage.ToolbarItems>
        <ToolbarItem Text="{Binding IsEditing, Converter={StaticResource BoolToObjectConverter}, ConverterParameter='Save|Edit'}" 
                     Command="{Binding ToggleEditModeCommand}" />
    </ContentPage.ToolbarItems>

    <ScrollView>
        <VerticalStackLayout Spacing="15" Padding="20">

            <VerticalStackLayout Spacing="10" HorizontalOptions="Center">
                <Grid WidthRequest="120" HeightRequest="120">
                    <Frame CornerRadius="60" Padding="0" IsClippedToBounds="True" BorderColor="White" HasShadow="True">
                        <Image Source="{Binding ProfileImage}" Aspect="AspectFill" />
                    </Frame>

                    <Frame CornerRadius="20" 
                           HeightRequest="40" WidthRequest="40" 
                           BackgroundColor="{StaticResource PrimaryColor}"
                           Padding="0"
                           VerticalOptions="End" HorizontalOptions="End"
                           IsVisible="{Binding IsEditing}">
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding ChangePhotoCommand}"/>
                        </Frame.GestureRecognizers>
                        <Label Text="📷" TextColor="White" VerticalOptions="Center" HorizontalOptions="Center"/>
                    </Frame>
                </Grid>

                <Label Text="{Binding UserName}" 
                       FontSize="24" FontAttributes="Bold" 
                       HorizontalOptions="Center" TextColor="Black"
                       IsVisible="{Binding IsNotEditing}"/>

                <Entry Text="{Binding UserName}" 
                       Placeholder="Enter Name"
                       HorizontalOptions="Center" 
                       HorizontalTextAlignment="Center"
                       WidthRequest="200"
                       IsVisible="{Binding IsEditing}"/>

                <Label Text="{Binding StudentId, StringFormat='ID: {0}'}" 
                       FontSize="14" TextColor="Gray" 
                       HorizontalOptions="Center" />
            </VerticalStackLayout>

            <Frame BackgroundColor="White" CornerRadius="15" Padding="15" BorderColor="Transparent" HasShadow="True">
                <VerticalStackLayout>
                    <Label Text="{Binding ReportsSubmitted}" 
                           FontSize="24" FontAttributes="Bold" 
                           TextColor="{StaticResource AlertRed}" 
                           HorizontalOptions="Center" />
                    <Label Text="Reports Submitted" 
                           FontSize="12" TextColor="Gray" 
                           HorizontalOptions="Center" />
                </VerticalStackLayout>
            </Frame>

            <Frame BackgroundColor="White" CornerRadius="15" Padding="20" BorderColor="Transparent" HasShadow="True">
                <VerticalStackLayout Spacing="15">
                    <Label Text="Personal Details" FontSize="16" FontAttributes="Bold" TextColor="{StaticResource PrimaryColor}"/>

                    <VerticalStackLayout>
                        <Label Text="Bio" TextColor="Gray" FontSize="12"/>
                        <Label Text="{Binding Bio}" FontSize="16" TextColor="Black" IsVisible="{Binding IsNotEditing}"/>
                        <Entry Text="{Binding Bio}" Placeholder="Short bio..." IsVisible="{Binding IsEditing}" BackgroundColor="#F0F0F0"/>
                    </VerticalStackLayout>

                    <BoxView HeightRequest="1" Color="#F0F0F0"/>

                    <VerticalStackLayout>
                        <Label Text="Email" TextColor="Gray" FontSize="12"/>
                        <Label Text="{Binding UserEmail}" FontSize="16" TextColor="Black" IsVisible="{Binding IsNotEditing}"/>
                        <Entry Text="{Binding UserEmail}" Placeholder="Email" IsVisible="{Binding IsEditing}" BackgroundColor="#F0F0F0"/>
                    </VerticalStackLayout>

                    <BoxView HeightRequest="1" Color="#F0F0F0"/>

                    <VerticalStackLayout>
                        <Label Text="Phone" TextColor="Gray" FontSize="12"/>
                        <Label Text="{Binding PhoneNumber}" FontSize="16" TextColor="Black" IsVisible="{Binding IsNotEditing}"/>
                        <Entry Text="{Binding PhoneNumber}" Keyboard="Telephone" IsVisible="{Binding IsEditing}" BackgroundColor="#F0F0F0"/>
                    </VerticalStackLayout>
                </VerticalStackLayout>
            </Frame>

            <Button Text="{Binding IsEditing, Converter={StaticResource BoolToObjectConverter}, ConverterParameter='Save Changes|Edit Profile'}" 
                    Command="{Binding ToggleEditModeCommand}" 
                    BackgroundColor="{StaticResource CalmBlue}" 
                    CornerRadius="25" HeightRequest="50" 
                    FontAttributes="Bold"/>

            <Button Text="Logout" 
                    Command="{Binding LogoutCommand}" 
                    BackgroundColor="White" 
                    TextColor="{StaticResource AlertRed}"
                    BorderColor="{StaticResource AlertRed}"
                    BorderWidth="1"
                    CornerRadius="25" HeightRequest="50"/>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>